(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"6.1.20"};var i=new e.Error().stack;i&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[i]="bc5b2c46-0da6-4da3-a90f-baf24bc4dc6c",e._sentryDebugIdIdentifier="sentry-dbid-bc5b2c46-0da6-4da3-a90f-baf24bc4dc6c")}catch{}})();var w=Object.freeze({cache:!0,base:"emoji",scale:.5,speed:10,density:3,staggered:!0,increaseSpeed:.08,emoji:null}),a=function(e){this.emojis=[],this.kichikuing=!1,this.repeater=null,this.emojiImg=null,this.options=Object.assign({},w,e),this._speed=this.options.speed,this.initialize()},v={windowSize:{configurable:!0}};a.prototype.preLoadImage=function(e){return new Promise((function(i,n){var t=new Image;t.src=e,t.complete?i(t):(t.onload=function(){i(t)},t.onerror=function(){n(t)})}))},a.prototype.initialize=function(){var e=this.options;this.canvas=typeof e.base=="string"?document.getElementById(e.base):e.base,this.canvas.width=this.canvas.width||this.windowSize.width,this.canvas.height=this.canvas.height||this.windowSize.height,this.context=this.canvas.getContext("2d");var i=window.devicePixelRatio||e.ratio||1,n=a.getPixelRatio(this.context),t=this.options.ratio||i/n;this.options.ratio=t,this.canvas.style.width=this.canvas.width+"px",this.canvas.style.height=this.canvas.height+"px",this.canvas.width*=t,this.canvas.height*=t,e.cache&&this.createCacheCanvas(),this.createEmojis()},a.prototype.createEmojis=function(){var e=this,i=this.options,n=this.emojis;return i.emoji?this.preLoadImage(i.emoji).then((function(t){e.emojiImg=t;for(var s=parseInt(e.canvas.style.width),l=parseInt(s/(t.width*i.scale))*i.density,r=0;r<l;r++){var o=s/l*r*i.ratio,f=-a.rand(e.canvas.height);i.staggered&&(o=o*Math.random()*2);var h=a.rand(6)/10;h=h<.5?.8:h;var p={x:~~(.5+o),y:~~(.5+f),w:~~(.5+t.width*h),h:~~(.5+t.height*h),scale:i.scale};if(i.staggered){var c=0,d=e.canvas.width,g=d/3,u=2*g;if(o<g)c=o+1.2*d*Math.random();else if(o>u)c=o-1.2*u*Math.random();else{var m=Math.random();c=m<.5?g*m:d*Math.random()}p.targetX=~~(.5+c)}n.push(p)}})):Promise.reject(new Error("未得到有效的 emoji 地址，无法继续！"))},a.prototype.drawStep=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var e=!1,i=this.canvas.height;this._speed+=this.options.increaseSpeed,this.cacheCanvasContext.clearRect(0,0,this.canvas.width,this.canvas.height);for(var n=0;n<this.emojis.length;n++){var t=this.emojis[n],s=.6*this._speed;t.y<i?(this.options.staggered&&(t.x<t.targetX?t.targetX-t.x<s?t.x=t.targetX:t.x+=s:t.x-t.targetX<s?t.x=t.targetX:t.x-=s),t.y+=this._speed,this.options.cache?this.cacheCanvasContext.drawImage(this.emojiImg,~~(.5+t.x),~~(.5+t.y),~~(.5+t.w*t.scale),~~(.5+t.h*t.scale)):this.context.drawImage(this.emojiImg,~~(.5+t.x),~~(.5+t.y),~~(.5+t.w*t.scale),~~(.5+t.h*t.scale)),e=!0):(this.emojis[n]=null,this.emojis.splice(n,1))}e?this.options.cache&&this.context.drawImage(this.cacheCanvas,0,0,this.canvas.width,this.canvas.height):(this.kichikuing=!1,window.cancelAnimationFrame(this.repeater),this.options.onEnded&&this.options.onEnded())},a.prototype.createCacheCanvas=function(){this.cacheCanvas=document.createElement("canvas"),this.cacheCanvas.width=this.canvas.width,this.cacheCanvas.height=this.canvas.height,this.cacheCanvasContext=this.cacheCanvas.getContext("2d")},a.prototype._launch=function(){this.kichikuing=!0,this.repeater=window.requestAnimationFrame(this._launch.bind(this)),this.drawStep()},a.prototype.launch=function(){var e=this;if(this.kichikuing)return!1;this.createEmojis().then((function(){e.options.onStart&&e.options.onStart(),e._speed=e.options.speed,e._launch()}))},a.prototype.update=function(e){e&&(this.options=Object.assign({},this.options,e))},v.windowSize.get=function(){return{width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}},a.getPixelRatio=function(e){return e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1},a.rand=function(e){return Math.floor(Math.random()*e+1)},Object.defineProperties(a.prototype,v);export{a as default};
